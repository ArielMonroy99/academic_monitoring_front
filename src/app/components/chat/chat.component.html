<div id="messages" class="overflow-y-hidden md:border border-none rounded-md md:p-2">
  <div class="flex w-full items-center">
    <button class="flex lg:hidden p-1 rounded-full bg-primary mx-1" (click)="onBackButtonHandler()" >
      <img src="assets/back.svg" alt="back icon">
    </button>
    @if (receiverUser.imageUrl) {
      <img src="{{ this.receiverUser.imageUrl }}" alt="user image" />
    } @else {
      <img
        src="./assets/user.svg"
        class="w-8 h-8"
        height="2rem"
        width="2rem"
        alt="user svg"
      />
    }
    <h2 class="mx-4">{{ receiverUser.name }} {{ receiverUser.lastname }}</h2>
  </div>
  <div class="w-full md:h-[30rem] h-full border rounded-md p-0 md:p-2 bg-white my-2" id="chat">
    <ul
      class="flex flex-col-reverse md:h-[29rem] h-[67vh] w-full overflow-y-auto items-end p-2"
    >
      @for (
        message of messages;
        track message;
        let i = $index;
        let last = $last;
        let first = $first;
      ) {
        <li
          class="flex flex-col w-full my-2"
          appEnterTheViewportNotifier
          (visibilityChange)="onMessageSeen($event, message)"
        >
          <div
            class="p-2 border rounded-md w-fit max-w-[18rem] flex flex-col"
            [ngStyle]="messageStyle(message)"
          >
            <div class="flex w-full justify-between">
              <span class="text-sm text-amber-600">{{
                messageName(message)
              }}</span>
            </div>
            <div class="flex w-full justify-between items-end">
              <p class="break-words max-w-[85%]">{{ message.content }}</p>
              <span class="text-xs ml-3">{{
                message.date | date: "HH:mm" : "America/La_Paz" : "en-ES"
              }}</span>
            </div>
          </div>
        </li>
        @if (last || (!last && getDate(messages[i + 1].date) !== getDate(message.date))) {
          <li class="flex justify-center w-full">
            <span class="text-xs bg-gray-100 rounded-full px-2">{{
              message.date | date: "dd/MM/yyyy" : "America/La_Paz" : "en-ES"
            }}</span>
          </li>
        }
      }
    </ul>
  </div>
  <div class="flex w-full px-2">
    <textarea
      class="resize-none w-full px-2 py-1 border rounded-md focus:outline-none focus:ring-0 focus:ring-transparent"
      [(ngModel)]="message"
      (keydown)="onKeyDown($event)"
    ></textarea>
    <button
      class="border rounded-full w-8 h-8 flex justify-center items-center bg-primary mx-2 disabled:opacity-60 cursor-pointer disabled:cursor-no-drop"
      (click)="onSendMessage()"
      [disabled]="message === ''"
    >
      <img src="../../../assets/send.svg" alt="send icon" class="w-5 h-5" />
    </button>
  </div>
</div>
